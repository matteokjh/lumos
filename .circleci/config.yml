version: 2.1
workflows:
    build-and-deploy-lumos-fe:
        jobs:
            - buildAndDeploy
jobs:
    buildAndDeploy:
        docker:
            - image: "circleci/node"
        steps:
            - checkout
            - run:
                  name: Check node version
                  command: |
                      node -v
                      npm -v
                      yarn -v
            - restore_cache:
                  key: dependency-cache-{{ checksum "yarn.lock" }}
            # - run:
            #       name: Install dependencies
            #       command: yarn
            # - run:
            #       name: build
            #       command: yarn build
            - run:
                name: Scan ssh key
                command: ssh-keyscan $BACKEND_HOST >> ~/.ssh/known_hosts
            - add_ssh_keys:
                fingerprints:
                    - 05:03:e2:f8:85:f5:45:45:92:46:e6:19:a0:06:8a:68
            - run:
                name: Install rsync
                command: sudo apt-get install rsync -y
            - run:
                name: Deploy
                command: |
                    rsync -avz -e ssh ./build root@$BACKEND_HOST:$LUMOS_DIR/test 2>&1
